<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
<head>
    <!-- All head content same as before -->
    <!-- ... -->
    <style>
        /* All styles same */
    </style>
</head>
<body>
    <!-- Navbar same -->
    <!-- Main Content -->
    <main class="container max-w-1400 mx-auto p-6">
        <!-- Header same -->
        <div class="card">
            <div class="calculator-form">
                <!-- Investment input -->
                <div class="input-group">
                    <label for="investment">Investment Amount ($)</label>
                    <input type="number" id="investment" placeholder="e.g., 10000" value="10000" min="1">
                </div>

                <!-- ETF Select -->
                <div class="input-group">
                    <label for="etf-select">Select ETF</label>
                    <select id="etf-select">
                        <optgroup label="Bitcoin Spot ETFs">
                            <option value="IBIT">IBIT - BlackRock</option>
                            <option value="FBTC">FBTC - Fidelity</option>
                            <option value="GBTC">GBTC - Grayscale</option>
                            <option value="ARKB">ARKB - ARK/21Shares</option>
                            <option value="BITB">BITB - Bitwise</option>
                            <option value="average-btc">Average Bitcoin ETF</option>
                        </optgroup>
                        <optgroup label="Ethereum Spot ETFs">
                            <option value="ETHA">ETHA - BlackRock</option>
                            <option value="FETH">FETH - Fidelity</option>
                            <option value="ETHE">ETHE - Grayscale</option>
                            <option value="ETH-MINI">ETH Mini - Grayscale</option>
                            <option value="ETHW">ETHW - Bitwise</option>
                            <option value="average-eth">Average Ethereum ETF</option>
                        </optgroup>
                        <optgroup label="Thematic & Leveraged">
                            <option value="BITQ">BITQ - Bitwise Crypto Innovators</option>
                            <option value="MSTX">MSTX - Defiance 2x MicroStrategy</option>
                            <option value="WGMI">WGMI - CoinShares Mining/AI</option>
                            <option value="STCE">STCE - Schwab Thematic</option>
                            <option value="MNRS">MNRS - Grayscale Miners</option>
                        </optgroup>
                    </select>
                </div>

                <!-- Purchase Date -->
                <div class="input-group">
                    <label for="purchase-date">Purchase Date</label>
                    <input type="date" id="purchase-date" value="2025-01-01">
                </div>

                <!-- Calculate Button -->
                <button onclick="calculateROI()" class="btn w-full text-lg py-3">Calculate Live ROI</button>

                <!-- Result & Loading -->
                <div id="result" class="result-box hidden">
                    <div id="result-content"></div>
                    <p class="text-sm opacity-70 mt-4">Live data from Yahoo Finance. Hypothetical; past performance not indicative of future results.</p>
                </div>
                <p id="loading" class="loading hidden text-center mt-4">Fetching live prices...</p>
            </div>
        </div>

        <!-- Disclaimer & Footer -->
    </main>

    <script>
        // ETF symbols (same as before)
        const ETF_SYMBOLS = {
            'IBIT': 'IBIT',
            'FBTC': 'FBTC',
            'GBTC': 'GBTC',
            'ARKB': 'ARKB',
            'BITB': 'BITB',
            'average-btc': ['IBIT', 'FBTC', 'GBTC', 'ARKB', 'BITB'],
            'ETHA': 'ETHA',
            'FETH': 'FETH',
            'ETHE': 'ETHE',
            'ETH-MINI': 'ETH',
            'ETHW': 'ETHW',
            'average-eth': ['ETHA', 'FETH', 'ETHE', 'ETH', 'ETHW'],
            'BITQ': 'BITQ',
            'MSTX': 'MSTX',
            'WGMI': 'WGMI',
            'STCE': 'STCE',
            'MNRS': 'MNRS'
        };

        // fetchPrice and calculateROI functions (same as before)
        async function fetchPrice(symbol) {
            const proxy = 'https://api.allorigins.win/get?url=' + encodeURIComponent('https://query1.finance.yahoo.com/v8/finance/chart/' + symbol + '?range=1d&interval=1d');
            try {
                const resp = await fetch(proxy);
                const data = await resp.json();
                const parsed = JSON.parse(data.contents);
                const close = parsed.chart.result[0].meta.regularMarketPrice;
                return close;
            } catch (e) {
                console.error('Fetch error for ' + symbol, e);
                return null;
            }
        }

        async function calculateROI() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('result').classList.add('hidden');

            const investment = parseFloat(document.getElementById('investment').value) || 0;
            const etfKey = document.getElementById('etf-select').value;
            const purchaseDate = document.getElementById('purchase-date').value;

            if (investment <= 0 || !purchaseDate) {
                alert('Valid amount and date required.');
                document.getElementById('loading').classList.add('hidden');
                return;
            }

            let symbols = Array.isArray(ETF_SYMBOLS[etfKey]) ? ETF_SYMBOLS[etfKey] : [ETF_SYMBOLS[etfKey]];
            let currentPrices = [];
            let purchasePrices = [];

            for (let sym of symbols) {
                const current = await fetchPrice(sym);
                if (current) currentPrices.push(current);

                const timestamp = Math.floor(new Date(purchaseDate).getTime() / 1000);
                const histProxy = 'https://api.allorigins.win/get?url=' + encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${sym}?period1=${timestamp}&period2=${timestamp}&interval=1d`);
                try {
                    const hresp = await fetch(histProxy);
                    const hdata = await hresp.json();
                    const hparsed = JSON.parse(hdata.contents);
                    const hclose = hparsed.chart.result[0]?.meta?.regularMarketPrice || current || 0;
                    purchasePrices.push(hclose);
                } catch (err) {
                    purchasePrices.push(current || 0);
                }
            }

            document.getElementById('loading').classList.add('hidden');

            if (currentPrices.length === 0) {
                alert('Failed to fetch current prices. Check connection or try later.');
                return;
            }

            const avgCurrent = currentPrices.reduce((a,b) => a + b, 0) / currentPrices.length;
            const avgPurchase = purchasePrices.reduce((a,b) => a + b, 0) / purchasePrices.length || 1;

            const returnPct = ((avgCurrent - avgPurchase) / avgPurchase) * 100;
            const finalValue = investment * (avgCurrent / avgPurchase);
            const profit = finalValue - investment;
            const profitClass = profit >= 0 ? 'profit-positive' : 'profit-negative';

            const etfName = document.querySelector(`#etf-select option[value="${etfKey}"]`).textContent.trim();

            document.getElementById('result-content').innerHTML = `
                <strong>${etfName}</strong><br>
                Purchase Date: ${purchaseDate} (~$${avgPurchase.toFixed(2)}/share)<br>
                Current Price: ~$${avgCurrent.toFixed(2)}/share<br><br>
                Initial Investment: $${investment.toLocaleString()}<br>
                Current Value: $${finalValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}<br>
                <span class="${profitClass}">Profit/Loss: $${Math.abs(profit).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} 
                (${returnPct >= 0 ? '+' : ''}${returnPct.toFixed(2)}%)</span>
            `;

            document.getElementById('result').classList.remove('hidden');
        }

        // Theme switcher (same)
        function applyTheme(t) {
            document.documentElement.setAttribute('data-theme', t);
            localStorage.setItem('theme', t);
            document.getElementById('theme-select').value = t;
        }
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('theme') || 'normal';
            applyTheme(saved);
            document.getElementById('theme-select').addEventListener('change', e => applyTheme(e.target.value));
        });
    </script>
</body>
</html>
