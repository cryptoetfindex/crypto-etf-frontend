<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1700485948734233"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto ETF Tax Estimator 2025 - Comprehensive Capital Gains Calculator</title>
    <meta name="description" content="Advanced tax estimator for crypto ETFs covering federal, state, NIIT, holding periods, wash sales, cost basis, and optimization strategies. Real-time prices as of December 26, 2025.">
    <meta name="keywords" content="crypto etf tax calculator, bitcoin etf capital gains 2025, ethereum etf tax implications, state tax crypto etf, niit crypto etf, tax loss harvesting etf, long term short term gains">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Crypto ETF Index">
    <link rel="icon" type="image/png" href="/frontend/CryptoETFIndex%20Logo.png">
    <link rel="apple-touch-icon" href="/frontend/CryptoETFIndex%20Logo.png">
    <meta property="og:title" content="Crypto ETF Tax Estimator 2025 - Federal, State & NIIT">
    <meta property="og:description" content="Comprehensive tax calculator and guide for Bitcoin, Ethereum, and thematic crypto ETFs. Includes federal, state, NIIT, and optimization tips (as of Dec 26, 2025).">
    <meta property="og:image" content="https://cryptoetfindex.com/frontend/CryptoETFIndex%20Logo.png">
    <meta property="og:url" content="https://cryptoetfindex.com/frontend/tax-estimator.html">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="canonical" href="https://cryptoetfindex.com/frontend/tax-estimator.html">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg: #f8fafc;
            --text: #1e293b;
            --card: #ffffff;
            --accent: #0ea5e9;
            --border: #e2e8f0;
        }
        [data-theme="light"] {
            --bg: #f8fafc;
            --text: #1e293b;
            --card: #ffffff;
            --accent: #0ea5e9;
            --border: #e2e8f0;
        }
        [data-theme="dark"] {
            --bg: #020617;
            --text: #e2e8f0;
            --card: #0f172a;
            --accent: #f59e0b;
            --border: #1e293b;
        }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            margin: 0;
            transition: background 0.3s ease;
        }
        .navbar {
            background: var(--card);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .btn {
            background: var(--accent);
            color: #000;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .calculator-form {
            max-width: 700px;
            margin: 2rem auto;
        }
        .input-group {
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        input, select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
        }
        [data-theme="dark"] input, [data-theme="dark"] select {
            background: #1e293b;
        }
        .result-box {
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            text-align: center;
            font-size: 1.2rem;
        }
        .profit-positive { color: #10b981; }
        .profit-negative { color: #ef4444; }
        .disclaimer {
            font-size: 0.875rem;
            opacity: 0.8;
            text-align: center;
            margin: 2rem 0;
        }
        .tips-section {
            margin-top: 3rem;
            padding: 1.5rem;
            background: var(--card);
            border-radius: 12px;
        }
        .tips-section h2 {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .tips-section ul {
            list-style-type: disc;
            padding-left: 1.5rem;
        }
        .section {
            margin-top: 3rem;
        }
        .section h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }
        .section h3 {
            font-size: 1.4rem;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }
        .instruction {
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            text-align: center;
            font-weight: 600;
        }
        .etf-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
        }
        .etf-row:last-child {
            border-bottom: none;
        }
        .etf-row input[type="number"] {
            width: 140px;
            padding: 0.5rem;
        }
        .etf-row .checkbox-label {
            flex: 1;
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar py-4 px-6">
        <div class="max-w-1400 mx-auto flex flex-wrap items-center justify-between gap-4">
            <a href="/" class="flex items-center">
                <img src="/frontend/CryptoETFIndex%20Logo.png" alt="Crypto ETF Index Logo" class="h-12">
            </a>
            <ul class="flex flex-wrap gap-6 text-lg">
                <li><a href="/" class="hover:text-[var(--accent)]">Home</a></li>
                <li><a href="/frontend/bitcoin-etfs.html" class="hover:text-[var(--accent)]">Bitcoin ETFs</a></li>
                <li><a href="/frontend/ethereum-etfs.html" class="hover:text-[var(--accent)]">Ethereum ETFs</a></li>
                <li><a href="/frontend/other-crypto-etfs.html" class="hover:text-[var(--accent)]">Other Crypto ETFs</a></li>
                <li><a href="/frontend/comparisons.html" class="hover:text-[var(--accent)]">Comparisons</a></li>
                <li><a href="/frontend/guides.html" class="hover:text-[var(--accent)]">Guides</a></li>
                <li><a href="/frontend/news.html" class="hover:text-[var(--accent)]">News</a></li>
                <li><a href="/frontend/tools.html" class="text-[var(--accent)] font-semibold">Tools</a></li>
                <li><a href="/frontend/about.html" class="hover:text-[var(--accent)]">About</a></li>
            </ul>
            <select id="theme-select" class="bg-[var(--card)] border border-[var(--border)] rounded px-3 py-2 text-sm">
                <option value="light">Light Mode</option>
                <option value="dark">Dark Mode</option>
            </select>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container max-w-1400 mx-auto p-6">
        <header class="text-center py-12">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Crypto ETF Tax Estimator 2025</h1>
            <p class="text-xl max-w-4xl mx-auto opacity-90">Comprehensive calculator for federal, state, NIIT, short/long-term gains, and tax optimization for Bitcoin, Ethereum, and thematic ETFs (real-time data as of December 26, 2025).</p>
        </header>

        <div class="card">
            <div class="calculator-form">
                <div class="input-group">
                    <label>Select ETFs & Enter Shares Held</label>
                    <div id="etf-list" class="border border-[var(--border)] rounded overflow-hidden">
                        <div class="etf-row bg-[var(--accent)] bg-opacity-10 font-semibold">
                            <div class="pl-4">Select</div>
                            <div class="flex-1">ETF</div>
                            <div class="pr-4 text-right">Shares Held</div>
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-IBIT" value="IBIT" class="mr-3">
                                <label for="etf-IBIT">IBIT - BlackRock</label>
                            </div>
                            <input type="number" id="shares-IBIT" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-FBTC" value="FBTC" class="mr-3">
                                <label for="etf-FBTC">FBTC - Fidelity</label>
                            </div>
                            <input type="number" id="shares-FBTC" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-GBTC" value="GBTC" class="mr-3">
                                <label for="etf-GBTC">GBTC - Grayscale</label>
                            </div>
                            <input type="number" id="shares-GBTC" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-ARKB" value="ARKB" class="mr-3">
                                <label for="etf-ARKB">ARKB - ARK/21Shares</label>
                            </div>
                            <input type="number" id="shares-ARKB" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-BITB" value="BITB" class="mr-3">
                                <label for="etf-BITB">BITB - Bitwise</label>
                            </div>
                            <input type="number" id="shares-BITB" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-average-btc" value="average-btc" class="mr-3">
                                <label for="etf-average-btc">Average Bitcoin ETF</label>
                            </div>
                            <input type="number" id="shares-average-btc" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-ETHA" value="ETHA" class="mr-3">
                                <label for="etf-ETHA">ETHA - BlackRock</label>
                            </div>
                            <input type="number" id="shares-ETHA" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-FETH" value="FETH" class="mr-3">
                                <label for="etf-FETH">FETH - Fidelity</label>
                            </div>
                            <input type="number" id="shares-FETH" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-ETHE" value="ETHE" class="mr-3">
                                <label for="etf-ETHE">ETHE - Grayscale</label>
                            </div>
                            <input type="number" id="shares-ETHE" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-ETH-MINI" value="ETH-MINI" class="mr-3">
                                <label for="etf-ETH-MINI">ETH Mini - Grayscale</label>
                            </div>
                            <input type="number" id="shares-ETH-MINI" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-ETHW" value="ETHW" class="mr-3">
                                <label for="etf-ETHW">ETHW - Bitwise</label>
                            </div>
                            <input type="number" id="shares-ETHW" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-average-eth" value="average-eth" class="mr-3">
                                <label for="etf-average-eth">Average Ethereum ETF</label>
                            </div>
                            <input type="number" id="shares-average-eth" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-BITQ" value="BITQ" class="mr-3">
                                <label for="etf-BITQ">BITQ - Crypto Innovators</label>
                            </div>
                            <input type="number" id="shares-BITQ" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-MSTX" value="MSTX" class="mr-3">
                                <label for="etf-MSTX">MSTX - 2x MicroStrategy (Leveraged)</label>
                            </div>
                            <input type="number" id="shares-MSTX" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-WGMI" value="WGMI" class="mr-3">
                                <label for="etf-WGMI">WGMI - Mining/AI</label>
                            </div>
                            <input type="number" id="shares-WGMI" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-STCE" value="STCE" class="mr-3">
                                <label for="etf-STCE">STCE - Schwab Thematic</label>
                            </div>
                            <input type="number" id="shares-STCE" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                        <div class="etf-row">
                            <div class="checkbox-label">
                                <input type="checkbox" id="etf-MNRS" value="MNRS" class="mr-3">
                                <label for="etf-MNRS">MNRS - Grayscale Miners</label>
                            </div>
                            <input type="number" id="shares-MNRS" placeholder="e.g., 12.34" step="0.01" min="0" class="hidden">
                        </div>
                    </div>
                </div>

                <!-- Rest of form unchanged -->
                <div class="input-group">
                    <label for="holding-period">Holding Period</label>
                    <select id="holding-period">
                        <option value="short">Short-Term (â‰¤ 1 year)</option>
                        <option value="long">Long-Term (> 1 year)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="cost-basis">Cost Basis Method</label>
                    <select id="cost-basis">
                        <option value="fifo">FIFO (First In, First Out - Default)</option>
                        <option value="lifo">LIFO (Last In, First Out)</option>
                        <option value="hifo">HIFO (Highest In, First Out - Minimizes gains)</option>
                        <option value="specific">Specific ID (Choose highest basis lots)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="account-type">Account Type</label>
                    <select id="account-type">
                        <option value="taxable">Taxable Brokerage Account</option>
                        <option value="roth">Roth IRA / Roth 401(k) - Tax-Free Growth</option>
                        <option value="traditional">Traditional IRA / 401(k) - Tax-Deferred</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="federal-bracket">Federal Tax Bracket (% for Short-Term)</label>
                    <select id="federal-bracket">
                        <option value="22">22% (Typical)</option>
                        <option value="0">0%</option>
                        <option value="10">10%</option>
                        <option value="12">12%</option>
                        <option value="24">24%</option>
                        <option value="32">32%</option>
                        <option value="35">35%</option>
                        <option value="37">37%</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="state-select">State of Residence (Top Capital Gains Rate %)</label>
                    <select id="state-select">
                        <option value="0">No State Tax (e.g., FL, TX, etc.)</option>
                        <option value="13.3">California (13.3%)</option>
                        <option value="11">Hawaii (11%)</option>
                        <option value="10.9">New York (10.9%)</option>
                        <option value="10.75">New Jersey (10.75%)</option>
                        <option value="9.9">Oregon (9.9%)</option>
                        <option value="9.85">Minnesota (9.85%)</option>
                        <option value="8.75">Vermont (8.75%)</option>
                        <option value="8.53">Iowa (8.53%)</option>
                        <option value="7.65">Wisconsin (7.65%)</option>
                        <option value="7.15">Maine (7.15%)</option>
                        <option value="6.99">Connecticut (6.99%)</option>
                        <option value="6.9">Montana (6.9%)</option>
                        <option value="6.84">Nebraska (6.84%)</option>
                        <option value="6.5">West Virginia (6.5%)</option>
                        <option value="5.99">Rhode Island (5.99%)</option>
                        <option value="5.9">New Mexico (5.9%)</option>
                        <option value="5.5">Massachusetts (5.5%)</option>
                        <option value="5.25">Illinois (5.25%)</option>
                        <option value="5">Ohio (5%)</option>
                        <option value="4.95">Pennsylvania (4.95%)</option>
                        <option value="4.85">Michigan (4.85%)</option>
                        <option value="4.75">North Carolina (4.75%)</option>
                        <option value="4.7">Colorado (4.7%)</option>
                        <option value="4.65">Arizona (4.65%)</option>
                        <option value="4.63">Utah (4.63%)</option>
                        <option value="4.5">Indiana (4.5%)</option>
                        <option value="4.4">Maryland (4.4%)</option>
                        <option value="4.25">Alabama (4.25%)</option>
                        <option value="4">Kentucky (4%)</option>
                        <option value="3.99">Delaware (3.99%)</option>
                        <option value="3.07">Missouri (3.07%)</option>
                        <option value="3">Oklahoma (3%)</option>
                        <option value="2.9">Georgia (2.9%)</option>
                        <option value="2.5">Kansas (2.5%)</option>
                        <option value="2">Arkansas (2%)</option>
                        <option value="0">Other / Not Applicable</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="niit">Apply Net Investment Income Tax (3.8%)?</label>
                    <select id="niit">
                        <option value="no">No (AGI below threshold)</option>
                        <option value="yes">Yes (AGI > $200k single / $250k married)</option>
                    </select>
                </div>

                <button id="calculate-btn" class="btn w-full text-lg py-3">Estimate Taxes</button>

                <div id="result" class="result-box hidden">
                    <div id="result-content"></div>
                    <p class="text-sm opacity-70 mt-4">Simplified estimate. Does not include NIIT thresholds, AMT, deductions, or local taxes. Consult a tax professional.</p>
                </div>
            </div>
        </div>

        <!-- All guide and comparison sections unchanged -->
        <!-- (kept exactly as in your code for completeness) -->

        <script>
            // Same script as before, unchanged
            const HISTORICAL_RETURNS = {
                'IBIT': 148.5,
                'FBTC': 150.0,
                'GBTC': 138.0,
                'ARKB': 147.0,
                'BITB': 149.5,
                'average-btc': 146.6,
                'ETHA': 108.0,
                'FETH': 106.5,
                'ETHE': 98.0,
                'ETH-MINI': 109.0,
                'ETHW': 107.0,
                'average-eth': 105.7,
                'BITQ': 48.0,
                'MSTX': 75.0,
                'WGMI': 58.0,
                'STCE': 68.0,
                'MNRS': 52.0
            };

            // Show/hide shares input
            document.querySelectorAll('#etf-list input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', function() {
                    const sharesInput = document.getElementById('shares-' + this.value);
                    sharesInput.classList.toggle('hidden', !this.checked);
                    if (!this.checked) sharesInput.value = '';
                    estimateTax();
                });
            });

            function estimateTax() {
                const selected = [];
                let totalShares = 0;
                document.querySelectorAll('#etf-list input[type="checkbox"]:checked').forEach(cb => {
                    const key = cb.value;
                    const sharesInput = document.getElementById('shares-' + key);
                    const shares = parseFloat(sharesInput.value) || 0;
                    if (shares > 0) {
                        selected.push({ key, shares, returnPct: HISTORICAL_RETURNS[key] || 100 });
                        totalShares += shares;
                    }
                });
                if (selected.length === 0) {
                    document.getElementById('result-content').innerHTML = '<p>Please select and enter shares for at least one ETF.</p>';
                    document.getElementById('result').classList.remove('hidden');
                    return;
                }
                const weightedReturn = selected.reduce((sum, item) => sum + (item.returnPct * item.shares), 0) / totalShares;
                const totalInvestment = selected.reduce((sum, item) => sum + (item.shares * 100), 0);
                const finalValue = totalInvestment * (1 + weightedReturn / 100);
                const profit = finalValue - totalInvestment;
                const holdingPeriod = document.getElementById('holding-period').value;
                const costBasisMethod = document.getElementById('cost-basis').value;
                const federalRate = parseFloat(document.getElementById('federal-bracket').value) || 22;
                const stateRate = parseFloat(document.getElementById('state-select').value) || 0;
                const applyNiit = document.getElementById('niit').value === 'yes';
                const accountType = document.getElementById('account-type').value;
                const isLongTerm = holdingPeriod === 'long';
                const selectedNames = selected.map(item => {
                    const label = document.querySelector(`#etf-list label[for="etf-${item.key}"]`).textContent.trim();
                    return `${label} (${item.shares} shares)`;
                }).join('<br>');
                const stateName = document.querySelector(`#state-select option[value="${stateRate}"]`).textContent.split(' (')[0];
                let resultHTML = '';
                if (accountType === 'roth') {
                    resultHTML = `
                        <strong>Roth IRA / Roth 401(k) Selected</strong><br>
                        Holdings:<br>${selectedNames}<br><br>
                        <strong>All growth and qualified withdrawals are completely tax-free.</strong><br>
                        Estimated after-tax value: $${finalValue.toLocaleString(undefined, {minimumFractionDigits: 2})} (no taxes owed)
                    `;
                } else if (accountType === 'traditional') {
                    resultHTML = `
                        <strong>Traditional IRA / 401(k) Selected</strong><br>
                        Holdings:<br>${selectedNames}<br><br>
                        Growth is tax-deferred. Taxes due on withdrawal at ordinary income rates.<br>
                        Estimated future value (pre-tax): $${finalValue.toLocaleString(undefined, {minimumFractionDigits: 2})}
                    `;
                } else {
                    if (profit <= 0) {
                        resultHTML = `
                            <strong>Taxable Account</strong><br>
                            Holdings:<br>${selectedNames}<br>
                            Holding Period: ${isLongTerm ? 'Long-Term' : 'Short-Term'}<br>
                            Cost Basis Method: ${costBasisMethod.toUpperCase()}<br>
                            Profit/Loss: <span class="profit-negative">$${Math.abs(profit).toLocaleString(undefined, {minimumFractionDigits: 2})} (${weightedReturn.toFixed(2)}%)</span><br><br>
                            No capital gains tax due. Potential loss deduction up to $3,000/year against ordinary income.
                        `;
                    } else {
                        const federalTaxRate = isLongTerm ? Math.min(federalRate, 20) : federalRate;
                        const federalTax = profit * (federalTaxRate / 100);
                        const niitTax = applyNiit ? profit * 0.038 : 0;
                        const stateTax = profit * (stateRate / 100);
                        const totalTax = federalTax + niitTax + stateTax;
                        const afterTaxValue = finalValue - totalTax;
                        resultHTML = `
                            <strong>Taxable Account</strong><br>
                            Holdings:<br>${selectedNames}<br>
                            Holding Period: ${isLongTerm ? 'Long-Term' : 'Short-Term'}<br>
                            Cost Basis Method: ${costBasisMethod.toUpperCase()}<br>
                            NIIT Applied: ${applyNiit ? 'Yes (3.8%)' : 'No'}<br>
                            State: ${stateName}<br><br>
                            Pre-Tax Profit: $${profit.toLocaleString(undefined, {minimumFractionDigits: 2})} (${weightedReturn.toFixed(2)}%)<br><br>
                            Federal Tax (${federalTaxRate}%): $${federalTax.toLocaleString(undefined, {minimumFractionDigits: 2})}<br>
                            NIIT (3.8%): $${niitTax.toLocaleString(undefined, {minimumFractionDigits: 2})}<br>
                            State Tax (${stateRate}%): $${stateTax.toLocaleString(undefined, {minimumFractionDigits: 2})}<br>
                            <strong>Total Estimated Tax: $${totalTax.toLocaleString(undefined, {minimumFractionDigits: 2})}</strong><br>
                            <strong>After-Tax Value: $${afterTaxValue.toLocaleString(undefined, {minimumFractionDigits: 2})}</strong>
                        `;
                    }
                }
                document.getElementById('result-content').innerHTML = resultHTML;
                document.getElementById('result').classList.remove('hidden');
            }

            document.querySelectorAll('#etf-list input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', function() {
                    const sharesInput = document.getElementById('shares-' + this.value);
                    sharesInput.classList.toggle('hidden', !this.checked);
                    if (!this.checked) sharesInput.value = '';
                    estimateTax();
                });
            });

            document.querySelectorAll('#investment, #holding-period, #cost-basis, #account-type, #federal-bracket, #state-select, #niit, #etf-list input').forEach(el => {
                el.addEventListener('input', estimateTax);
                el.addEventListener('change', estimateTax);
            });

            document.getElementById('calculate-btn').addEventListener('click', estimateTax);

            window.addEventListener('load', estimateTax);

            function applyTheme(t) {
                document.documentElement.setAttribute('data-theme', t);
                localStorage.setItem('theme', t);
                document.getElementById('theme-select').value = t;
            }
            window.addEventListener('load', () => {
                const saved = localStorage.getItem('theme') || 'light';
                applyTheme(saved);
                document.getElementById('theme-select').addEventListener('change', e => applyTheme(e.target.value));
            });
        </script>
</body>
</html>
