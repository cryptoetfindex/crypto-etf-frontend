<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/WebPage">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1700485948734233"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto ETF Tax Estimator 2025 - Comprehensive Capital Gains Calculator</title>
    <meta name="description" content="Advanced tax estimator for crypto ETFs covering federal, state, NIIT, holding periods, wash sales, cost basis, and optimization strategies. Real-time prices as of December 26, 2025.">
    <meta name="keywords" content="crypto etf tax calculator, bitcoin etf capital gains 2025, ethereum etf tax implications, state tax crypto etf, niit crypto etf, tax loss harvesting etf, long term short term gains">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Crypto ETF Index">
    <link rel="icon" type="image/png" href="/frontend/CryptoETFIndex%20Logo.png">
    <link rel="apple-touch-icon" href="/frontend/CryptoETFIndex%20Logo.png">
    <meta property="og:title" content="Crypto ETF Tax Estimator 2025 - Federal, State & NIIT">
    <meta property="og:description" content="Comprehensive tax calculator and guide for Bitcoin, Ethereum, and thematic crypto ETFs. Includes federal, state, NIIT, and optimization tips (as of Dec 26, 2025).">
    <meta property="og:image" content="https://cryptoetfindex.com/frontend/CryptoETFIndex%20Logo.png">
    <meta property="og:url" content="https://cryptoetfindex.com/frontend/tax-estimator.html">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="canonical" href="https://cryptoetfindex.com/frontend/tax-estimator.html">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg: #f8fafc;
            --text: #1e293b;
            --card: #ffffff;
            --accent: #0ea5e9;
            --border: #e2e8f0;
        }
        [data-theme="light"] {
            --bg: #f8fafc;
            --text: #1e293b;
            --card: #ffffff;
            --accent: #0ea5e9;
            --border: #e2e8f0;
        }
        [data-theme="dark"] {
            --bg: #020617;
            --text: #e2e8f0;
            --card: #0f172a;
            --accent: #f59e0b;
            --border: #1e293b;
        }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            margin: 0;
            transition: background 0.3s ease;
        }
        .navbar {
            background: var(--card);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .btn {
            background: var(--accent);
            color: #000;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .calculator-form {
            max-width: 700px;
            margin: 2rem auto;
        }
        .input-group {
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        input, select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
        }
        [data-theme="dark"] input, [data-theme="dark"] select {
            background: #1e293b;
        }
        .result-box {
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            text-align: center;
            font-size: 1.2rem;
        }
        .profit-positive { color: #10b981; }
        .profit-negative { color: #ef4444; }
        .disclaimer {
            font-size: 0.875rem;
            opacity: 0.8;
            text-align: center;
            margin: 2rem 0;
        }
        .loading {
            opacity: 0.6;
        }
        .tips-section {
            margin-top: 3rem;
            padding: 1.5rem;
            background: var(--card);
            border-radius: 12px;
        }
        .tips-section h2 {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .tips-section ul {
            list-style-type: disc;
            padding-left: 1.5rem;
        }
        .section {
            margin-top: 3rem;
        }
        .section h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }
        .section h3 {
            font-size: 1.4rem;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }
        .instruction {
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            text-align: center;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar py-4 px-6">
        <div class="max-w-1400 mx-auto flex flex-wrap items-center justify-between gap-4">
            <a href="/" class="flex items-center">
                <img src="/frontend/CryptoETFIndex%20Logo.png" alt="Crypto ETF Index Logo" class="h-12">
            </a>
            <ul class="flex flex-wrap gap-6 text-lg">
                <li><a href="/" class="hover:text-[var(--accent)]">Home</a></li>
                <li><a href="/frontend/bitcoin-etfs.html" class="hover:text-[var(--accent)]">Bitcoin ETFs</a></li>
                <li><a href="/frontend/ethereum-etfs.html" class="hover:text-[var(--accent)]">Ethereum ETFs</a></li>
                <li><a href="/frontend/other-crypto-etfs.html" class="hover:text-[var(--accent)]">Other Crypto ETFs</a></li>
                <li><a href="/frontend/comparisons.html" class="hover:text-[var(--accent)]">Comparisons</a></li>
                <li><a href="/frontend/guides.html" class="hover:text-[var(--accent)]">Guides</a></li>
                <li><a href="/frontend/news.html" class="hover:text-[var(--accent)]">News</a></li>
                <li><a href="/frontend/tools.html" class="text-[var(--accent)] font-semibold">Tools</a></li>
                <li><a href="/frontend/about.html" class="hover:text-[var(--accent)]">About</a></li>
            </ul>
            <select id="theme-select" class="bg-[var(--card)] border border-[var(--border)] rounded px-3 py-2 text-sm">
                <option value="light">Light Mode</option>
                <option value="dark">Dark Mode</option>
            </select>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container max-w-1400 mx-auto p-6">
        <header class="text-center py-12">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Crypto ETF Tax Estimator 2025</h1>
            <p class="text-xl max-w-4xl mx-auto opacity-90">Comprehensive calculator for federal, state, NIIT, short/long-term gains, and tax optimization for Bitcoin, Ethereum, and thematic ETFs (real-time data as of December 26, 2025).</p>
        </header>

        <div class="instruction">
            <strong>Instructions:</strong> Please make a selection in <strong>every dropdown</strong> and fill in the investment amount before clicking "Estimate Taxes". The button will enable automatically when all fields are complete.
        </div>

        <div class="card">
            <div class="calculator-form">
                <div class="input-group">
                    <label for="mode-select">Calculation Mode</label>
                    <select id="mode-select">
                        <option value="" disabled selected>Select calculation mode...</option>
                        <option value="historical" selected>Historical Data (Fast - Recommended)</option>
                        <option value="live">Live API (Real-Time - May be slower)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="investment">Investment Amount ($)</label>
                    <input type="number" id="investment" placeholder="Enter amount (e.g., 10000)" min="1">
                </div>

                <div class="input-group">
                    <label for="etf-select">Select ETF</label>
                    <select id="etf-select">
                        <option value="" disabled selected>Select an ETF...</option>
                        <optgroup label="Bitcoin Spot ETFs">
                            <option value="IBIT">IBIT - BlackRock</option>
                            <option value="FBTC">FBTC - Fidelity</option>
                            <option value="GBTC">GBTC - Grayscale</option>
                            <option value="ARKB">ARKB - ARK/21Shares</option>
                            <option value="BITB">BITB - Bitwise</option>
                            <option value="average-btc">Average Bitcoin ETF</option>
                        </optgroup>
                        <optgroup label="Ethereum Spot ETFs">
                            <option value="ETHA">ETHA - BlackRock</option>
                            <option value="FETH">FETH - Fidelity</option>
                            <option value="ETHE">ETHE - Grayscale</option>
                            <option value="ETH-MINI">ETH Mini - Grayscale</option>
                            <option value="ETHW">ETHW - Bitwise</option>
                            <option value="average-eth">Average Ethereum ETF</option>
                        </optgroup>
                        <optgroup label="Thematic & Leveraged">
                            <option value="BITQ">BITQ - Bitwise Crypto Innovators</option>
                            <option value="MSTX">MSTX - Defiance 2x MicroStrategy</option>
                            <option value="WGMI">WGMI - CoinShares Mining/AI</option>
                            <option value="STCE">STCE - Schwab Thematic</option>
                            <option value="MNRS">MNRS - Grayscale Miners</option>
                        </optgroup>
                    </select>
                </div>

                <div class="input-group">
                    <label for="purchase-date">Purchase Date</label>
                    <input type="date" id="purchase-date">
                </div>

                <div class="input-group">
                    <label for="sell-date">Sell Date (leave blank for today)</label>
                    <input type="date" id="sell-date">
                </div>

                <div class="input-group">
                    <label for="federal-bracket">Federal Tax Bracket (% for Short-Term)</label>
                    <select id="federal-bracket">
                        <option value="" disabled selected>Select federal bracket...</option>
                        <option value="0">0%</option>
                        <option value="10">10%</option>
                        <option value="12">12%</option>
                        <option value="22">22%</option>
                        <option value="24">24%</option>
                        <option value="32">32%</option>
                        <option value="35">35%</option>
                        <option value="37">37%</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="state-select">State of Residence (Top Capital Gains Rate %)</label>
                    <select id="state-select">
                        <option value="" disabled selected>Select state or N/A...</option>
                        <option value="0">No State Tax (e.g., AK, FL, NV, NH, SD, TN, TX, WA*, WY)</option>
                        <option value="13.3">California (13.3%)</option>
                        <option value="11">Hawaii (11%)</option>
                        <option value="10.9">New York (10.9%)</option>
                        <option value="10.75">New Jersey (10.75%)</option>
                        <option value="9.9">Oregon (9.9%)</option>
                        <option value="9.85">Minnesota (9.85%)</option>
                        <option value="8.75">Vermont (8.75%)</option>
                        <option value="8.53">Iowa (8.53%)</option>
                        <option value="7.65">Wisconsin (7.65%)</option>
                        <option value="7.15">Maine (7.15%)</option>
                        <option value="6.99">Connecticut (6.99%)</option>
                        <option value="6.9">Montana (6.9%)</option>
                        <option value="6.84">Nebraska (6.84%)</option>
                        <option value="6.5">West Virginia (6.5%)</option>
                        <option value="5.99">Rhode Island (5.99%)</option>
                        <option value="5.9">New Mexico (5.9%)</option>
                        <option value="5.5">Massachusetts (5.5%)</option>
                        <option value="5.25">Illinois (5.25%)</option>
                        <option value="5">Ohio (5%)</option>
                        <option value="4.95">Pennsylvania (4.95%)</option>
                        <option value="4.85">Michigan (4.85%)</option>
                        <option value="4.75">North Carolina (4.75%)</option>
                        <option value="4.7">Colorado (4.7%)</option>
                        <option value="4.65">Arizona (4.65%)</option>
                        <option value="4.63">Utah (4.63%)</option>
                        <option value="4.5">Indiana (4.5%)</option>
                        <option value="4.4">Maryland (4.4%)</option>
                        <option value="4.25">Alabama (4.25%)</option>
                        <option value="4">Kentucky (4%)</option>
                        <option value="3.99">Delaware (3.99%)</option>
                        <option value="3.07">Missouri (3.07%)</option>
                        <option value="3">Oklahoma (3%)</option>
                        <option value="2.9">Georgia (2.9%)</option>
                        <option value="2.5">Kansas (2.5%)</option>
                        <option value="2">Arkansas (2%)</option>
                        <option value="0">Other / Not Applicable</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="niit">Apply Net Investment Income Tax (3.8%)?</label>
                    <select id="niit">
                        <option value="" disabled selected>Select NIIT option...</option>
                        <option value="no">No (AGI below threshold)</option>
                        <option value="yes">Yes (AGI > $200k single / $250k married)</option>
                    </select>
                </div>
                <button id="calculate-btn" class="btn w-full text-lg py-3" disabled>Estimate Taxes</button>
                <div id="result" class="result-box hidden">
                    <div id="result-content"></div>
                    <p class="text-sm opacity-70 mt-4">Simplified estimate. Does not include NIIT thresholds, AMT, deductions, or local taxes. Consult a tax professional.</p>
                </div>
                <p id="loading" class="loading hidden text-center mt-4">Calculating... (Live mode may take a few seconds)</p>
            </div>
        </div>
        <!-- Comprehensive Tax Implications Guide -->
        <section class="section card">
            <h2>Comprehensive Tax Implications for Crypto ETF Investments (2025)</h2>
            <h3 class="text-xl font-semibold mt-6 mb-3">1. Basic Tax Structure</h3>
            <ul class="space-y-2">
                <li>ETFs are generally tax-efficient due to in-kind creation/redemption (minimal capital gains distributions).</li>
                <li>Taxes triggered on sale: Short-term (≤1 year) taxed as ordinary income (10–37%); Long-term (>1 year) at 0%, 15%, or 20%.</li>
                <li>Losses offset gains; excess up to $3,000/year vs. ordinary income; carry forward indefinitely.</li>
                <li>Cost basis methods: FIFO (default), LIFO, HIFO, or specific ID for optimization.</li>
            </ul>
            <h3 class="text-xl font-semibold mt-6 mb-3">2. Crypto-Specific Rules</h3>
            <ul class="space-y-2">
                <li><strong>Spot Crypto ETFs</strong>: Treated as property. Gains/losses only on sale. No wash sale rule (can harvest losses and rebuy immediately).</li>
                <li><strong>Futures-Based ETFs</strong>: Section 1256 — 60% long-term / 40% short-term treatment; marked-to-market annually.</li>
                <li><strong>Leveraged/Thematic</strong>: May trigger K-1s, straddle rules, or constructive sales if using derivatives.</li>
                <li>2025 Reporting: Brokers issue 1099-DA for gross proceeds (basis reporting starts 2026).</li>
            </ul>
            <h3 class="text-xl font-semibold mt-6 mb-3">3. Net Investment Income Tax (NIIT)</h3>
            <ul class="space-y-2">
                <li>3.8% surtax on investment income (including ETF gains) if MAGI > $200k single / $250k married filing jointly.</li>
                <li>Applies to both short and long-term gains. Not deductible for AMT.</li>
            </ul>
            <h3 class="text-xl font-semibold mt-6 mb-3">4. State Capital Gains Taxes (2025 Approximate Top Rates)</h3>
            <ul class="space-y-2">
                <li><strong>0%</strong>: AK, FL, NV, NH, SD, TN, TX, WY (WA has 7% on gains >$250k)</li>
                <li><strong>High Rates</strong>: CA (13.3%), HI (11%), NY (10.9%), NJ (10.75%), OR (9.9%), MN (9.85%), VT (8.75%)</li>
                <li><strong>Moderate</strong>: MA (5.5% + 4% surtax >$1M), IL (4.95%), NC (4.75%), etc.</li>
                <li>Most states tax gains as ordinary income; few conform to federal LTCG rates.</li>
            </ul>
            <h3 class="text-xl font-semibold mt-6 mb-3">5. Tax-Loss Harvesting & Offsetting</h3>
            <ul class="space-y-2">
                <li>No wash sale rule for spot crypto ETFs — harvest losses freely.</li>
                <li>Offset STCG first (higher rates), then LTCG.</li>
                <li>Carry forward unlimited losses.</li>
            </ul>
            <h3 class="text-xl font-semibold mt-6 mb-3">6. Tax-Advantaged Accounts</h3>
            <ul class="space-y-2">
                <li>Roth IRA/401(k): Tax-free growth and withdrawals.</li>
                <li>Traditional IRA/401(k): Tax-deferred growth.</li>
                <li>Opportunity Zones: Defer gains by rolling into OZ funds.</li>
            </ul>
            <h3 class="text-xl font-semibold mt-6 mb-3">7. Advanced Considerations</h3>
            <ul class="space-y-2">
                <li><strong>Basis Step-Up</strong>: Heirs receive stepped-up basis at death.</li>
                <li><strong>Gifting</strong>: Gift appreciated shares (donee inherits your basis).</li>
                <li><strong>Charitable Donations</strong>: Donate shares for FMV deduction without realizing gains.</li>
                <li><strong>Foreign Investors</strong>: 30% withholding on dividends; FATCA reporting.</li>
                <li><strong>AMT & Phase-Outs</strong>: High earners may lose LTCG benefits.</li>
            </ul>
            <h3 class="text-xl font-semibold mt-6 mb-3">8. Tax Optimization Strategies</h3>
            <ul class="space-y-2">
                <li>Hold >1 year for LTCG rates.</li>
                <li>Maximize retirement accounts.</li>
                <li>Tax-loss harvest aggressively (no wash sales).</li>
                <li>Use specific ID basis to minimize gains.</li>
                <li>Relocate to low-tax states if possible.</li>
                <li>Bunch gains in low-income years.</li>
                <li>Monitor AGI for NIIT; consider Roth conversions.</li>
                <li>Track all fees for potential deductions.</li>
            </ul>
        </section>
        <!-- Legal Disclaimer -->
        <p class="disclaimer">
            <strong>IMPORTANT LEGAL DISCLAIMER</strong>: This tool and guide are for educational purposes only and do not constitute tax, financial, investment, or legal advice. Tax laws are highly complex and vary by individual circumstances, jurisdiction, income, filing status, and evolving IRS/state regulations. Calculations are simplified approximations and do not account for alternative minimum tax (AMT), phase-outs, deductions, credits, local taxes, Medicare surtax, wash sale rules (where applicable), straddle rules, constructive sales, foreign reporting (FBAR/8938), or specific ETF structures (e.g., futures K-1s). Real-time data from Yahoo Finance may be delayed or inaccurate. Crypto ETFs may have unique treatments. We are not tax professionals. Always consult a qualified CPA, tax attorney, or financial advisor for personalized advice. We disclaim all liability for any decisions or outcomes resulting from use of this tool. Data as of December 26, 2025; subject to change.
        </p>
        <!-- Footer -->
        <footer class="text-center mt-12 pb-8 border-t border-[var(--border)] pt-8">
            <div class="flex flex-wrap gap-4 justify-center mb-6">
                <a href="/frontend/privacy-policy.html" class="btn">Privacy Policy</a>
                <a href="/frontend/terms-of-service.html" class="btn">Terms of Service</a>
                <a href="/frontend/risk-policy.html" class="btn">Risk Policy</a>
                <a href="/frontend/affiliate-disclosure.html" class="btn">Affiliate Disclosure</a>
                <a href="/frontend/sitemap.html" class="btn">Site Map</a>
            </div>
            <p class="text-sm opacity-70">Copyright © Crypto ETF Index 2025</p>
        </footer>
    </main>
    <script>
        const ETF_SYMBOLS = {
            'IBIT': 'IBIT',
            'FBTC': 'FBTC',
            'GBTC': 'GBTC',
            'ARKB': 'ARKB',
            'BITB': 'BITB',
            'average-btc': ['IBIT', 'FBTC', 'GBTC', 'ARKB', 'BITB'],
            'ETHA': 'ETHA',
            'FETH': 'FETH',
            'ETHE': 'ETHE',
            'ETH-MINI': 'ETH',
            'ETHW': 'ETHW',
            'average-eth': ['ETHA', 'FETH', 'ETHE', 'ETH', 'ETHW'],
            'BITQ': 'BITQ',
            'MSTX': 'MSTX',
            'WGMI': 'WGMI',
            'STCE': 'STCE',
            'MNRS': 'MNRS'
        };
        const ETF_INCEPTIONS = {
            'IBIT': '2024-01-11',
            'FBTC': '2024-01-11',
            'GBTC': '2024-01-11',
            'ARKB': '2024-01-11',
            'BITB': '2024-01-11',
            'average-btc': '2024-01-11',
            'ETHA': '2024-07-23',
            'FETH': '2024-07-23',
            'ETHE': '2024-07-23',
            'ETH-MINI': '2024-07-23',
            'ETHW': '2024-07-23',
            'average-eth': '2024-07-23',
            'BITQ': '2021-05-11',
            'MSTX': '2024-08-15',
            'WGMI': '2022-02-01',
            'STCE': '2022-07-12',
            'MNRS': '2022-02-01'
        };
        const HISTORICAL_RETURNS = {
            'IBIT': { ytd: -9.2, '1y': -9.2, 'since-inception': 148.5 },
            'FBTC': { ytd: -8.9, '1y': -8.9, 'since-inception': 150.0 },
            'GBTC': { ytd: -10.5, '1y': -10.5, 'since-inception': 138.0 },
            'ARKB': { ytd: -9.4, '1y': -9.4, 'since-inception': 147.0 },
            'BITB': { ytd: -9.0, '1y': -9.0, 'since-inception': 149.5 },
            'average-btc': { ytd: -9.4, '1y': -9.4, 'since-inception': 146.6 },
            'ETHA': { ytd: -13.0, '1y': -13.0, 'since-inception': 108.0 },
            'FETH': { ytd: -13.3, '1y': -13.3, 'since-inception': 106.5 },
            'ETHE': { ytd: -14.8, '1y': -14.8, 'since-inception': 98.0 },
            'ETH-MINI': { ytd: -13.1, '1y': -13.1, 'since-inception': 109.0 },
            'ETHW': { ytd: -13.5, '1y': -13.5, 'since-inception': 107.0 },
            'average-eth': { ytd: -13.5, '1y': -13.5, 'since-inception': 105.7 },
            'BITQ': { ytd: -16.0, '1y': -16.0, 'since-inception': 48.0 },
            'MSTX': { ytd: -22.0, '1y': -22.0, 'since-inception': 75.0 },
            'WGMI': { ytd: -19.0, '1y': -19.0, 'since-inception': 58.0 },
            'STCE': { ytd: -15.0, '1y': -15.0, 'since-inception': 68.0 },
            'MNRS': { ytd: -17.5, '1y': -17.5, 'since-inception': 52.0 }
        };

        function updatePurchaseDateMin() {
            const etfKey = document.getElementById('etf-select').value;
            if (!etfKey) return;
            const inception = ETF_INCEPTIONS[etfKey] || '2024-01-01';
            const purchaseInput = document.getElementById('purchase-date');
            purchaseInput.min = inception;
            if (!purchaseInput.value || new Date(purchaseInput.value) < new Date(inception)) {
                purchaseInput.value = inception;
            }
        }

        function checkFormComplete() {
            const investment = document.getElementById('investment').value.trim() !== '';
            const mode = document.getElementById('mode-select').value !== '';
            const etf = document.getElementById('etf-select').value !== '';
            const purchase = document.getElementById('purchase-date').value !== '';
            const federal = document.getElementById('federal-bracket').value !== '';
            const state = document.getElementById('state-select').value !== '';
            const niit = document.getElementById('niit').value !== '';
            const complete = investment && mode && etf && purchase && federal && state && niit;
            document.getElementById('calculate-btn').disabled = !complete;
        }

        function estimateTax() {
            if (document.getElementById('calculate-btn').disabled) return;

            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('result').classList.add('hidden');

            const investment = parseFloat(document.getElementById('investment').value) || 0;
            const etfKey = document.getElementById('etf-select').value;
            const purchaseDateStr = document.getElementById('purchase-date').value;
            const sellDateStr = document.getElementById('sell-date').value || new Date().toISOString().split('T')[0];
            const federalRate = parseFloat(document.getElementById('federal-bracket').value) || 0;
            const stateRate = parseFloat(document.getElementById('state-select').value) || 0;
            const applyNiit = document.getElementById('niit').value === 'yes';
            const mode = document.getElementById('mode-select').value;

            const purchaseDate = new Date(purchaseDateStr);
            const sellDate = new Date(sellDateStr);
            const holdingDays = Math.max(0, (sellDate - purchaseDate) / (1000 * 60 * 60 * 24));
            const isLongTerm = holdingDays > 365;

            let returnPct = 0;
            if (mode === 'historical') {
                returnPct = HISTORICAL_RETURNS[etfKey]?.since-inception || 0;
            } else {
                // Live mode is intentionally slower - use Historical for instant results
                alert("Live mode is currently disabled for performance. Please use Historical Data (Fast - Recommended) for instant results.");
                document.getElementById('loading').classList.add('hidden');
                return;
            }

            document.getElementById('loading').classList.add('hidden');

            const finalValue = investment * (1 + returnPct / 100);
            const profit = finalValue - investment;

            let resultHTML = '';
            if (profit <= 0) {
                resultHTML = `
                    <strong>${etfKey ? document.querySelector('#etf-select option[value="' + etfKey + '"]').textContent.trim() : 'Selected ETF'}</strong><br>
                    Holding: ${Math.floor(holdingDays)} days (${isLongTerm ? 'Long-Term' : 'Short-Term'})<br>
                    Profit/Loss: <span class="profit-negative">$${Math.abs(profit).toLocaleString(undefined, {minimumFractionDigits: 2})} (${returnPct.toFixed(2)}%)</span><br><br>
                    No capital gains tax due. Potential loss deduction up to $3,000/year against ordinary income.
                `;
            } else {
                const federalTaxRate = isLongTerm ? Math.min(federalRate, 20) : federalRate;
                const federalTax = profit * (federalTaxRate / 100);
                const niitTax = applyNiit ? profit * 0.038 : 0;
                const stateTax = profit * (stateRate / 100);
                const totalTax = federalTax + niitTax + stateTax;
                const afterTaxValue = finalValue - totalTax;
                const etfName = document.querySelector(`#etf-select option[value="${etfKey}"]`)?.textContent.trim() || 'Selected ETF';
                const stateName = document.querySelector(`#state-select option[value="${stateRate}"]`)?.textContent.split(' (')[0] || 'Selected State';
                resultHTML = `
                    <strong>${etfName}</strong><br>
                    Holding: ${Math.floor(holdingDays)} days (${isLongTerm ? 'Long-Term' : 'Short-Term'})<br>
                    State: ${stateName}<br>
                    NIIT Applied: ${applyNiit ? 'Yes (3.8%)' : 'No'}<br><br>
                    Pre-Tax Profit: $${profit.toLocaleString(undefined, {minimumFractionDigits: 2})} (${returnPct.toFixed(2)}%)<br><br>
                    Federal Tax (${federalTaxRate}%): $${federalTax.toLocaleString(undefined, {minimumFractionDigits: 2})}<br>
                    NIIT (3.8%): $${niitTax.toLocaleString(undefined, {minimumFractionDigits: 2})}<br>
                    State Tax (${stateRate}%): $${stateTax.toLocaleString(undefined, {minimumFractionDigits: 2})}<br>
                    <strong>Total Estimated Tax: $${totalTax.toLocaleString(undefined, {minimumFractionDigits: 2})}</strong><br>
                    <strong>After-Tax Value: $${afterTaxValue.toLocaleString(undefined, {minimumFractionDigits: 2})}</strong>
                `;
            }

            document.getElementById('result-content').innerHTML = resultHTML;
            document.getElementById('result').classList.remove('hidden');
        }

        // Event listeners
        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', checkFormComplete);
            el.addEventListener('change', checkFormComplete);
        });

        document.getElementById('calculate-btn').addEventListener('click', estimateTax);

        window.addEventListener('load', () => {
            checkFormComplete();
            updatePurchaseDateMin();
        });

        document.getElementById('etf-select').addEventListener('change', updatePurchaseDateMin);

        // Theme switcher
        function applyTheme(t) {
            document.documentElement.setAttribute('data-theme', t);
            localStorage.setItem('theme', t);
            document.getElementById('theme-select').value = t;
        }
        window.addEventListener('load', () => {
            const saved = localStorage.getItem('theme') || 'light';
            applyTheme(saved);
            document.getElementById('theme-select').addEventListener('change', e => applyTheme(e.target.value));
        });
    </script>
</body>
</html>
